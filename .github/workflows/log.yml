name: Keep Render Alive

on:
  schedule:
    - cron: '*/15 * * * *'  # Every 15 minutes is usually sufficient
  workflow_dispatch:

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Server and Log Response
        run: |
          START_TIME=$(date +%s)
          RESPONSE=$(curl -s -m 10 --retry 2 -w "\n%{time_total}\n%{http_code}" -X GET "https://my-notebook-backend-d61x.onrender.com/" || echo "ERROR: Request failed")
          END_TIME=$(date +%s)
          ELAPSED_TIME=$((END_TIME - START_TIME))

          RESPONSE_TIME=$(echo "$RESPONSE" | tail -2 | head -1)
          HTTP_STATUS=$(echo "$RESPONSE" | tail -1)
          BODY=$(echo "$RESPONSE" | head -n -2)

          echo "ðŸ”¹ Ping Time: $(date '+%Y-%m-%d %H:%M:%S')" > logs.txt
          echo "â³ Elapsed Time: ${ELAPSED_TIME}s" >> logs.txt
          echo "ðŸŒ HTTP Status: ${HTTP_STATUS}" >> logs.txt
          echo "ðŸ“œ Response: ${BODY}" >> logs.txt
        continue-on-error: true  # Prevents job failure on curl error

      - name: Save Logs as Artifact
        if: always()  # Ensures logs are saved even if ping fails
        uses: actions/upload-artifact@v4
        with:
          name: ping-logs
          path: logs.txt
